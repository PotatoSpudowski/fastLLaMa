import{u as B,a as N,n as R,t as W,i as G,b as F,_ as H,c as X}from"./index-c57942c0.js";import{d as S,r as x,s as L,o as m,c as h,a as e,u,F as U,b as j,e as C,t as P,f as O,g as q,h as I,w as b,T as J,i as V,v as y,j as K,n as T,k as Q,l as $,m as Y,p as Z,q as ee,x as te,y as z,z as se}from"./index-9805b1fa.js";const oe={slot:"heading"},ne=e("h2",{class:"mb-2"},"Select a Modal",-1),le=["value"],ie={class:"max-h-[10rem] overflow-y-auto"},ae=["value","onDblclick"],de=["name"],re={class:"flex items-center gap-2 w-full justify-between"},ce={key:0,"aria-hidden":"true",name:"chevron-forward-outline"},_e={class:"flex flex-col"},ue={class:"min-w-fit mt-2"},me=["disabled"],pe=S({__name:"AppFilePicker",props:{show:{type:Boolean}},emits:["confirm","update:show"],setup(n,{emit:l}){const t=x(),d=x(!0);function c(){t.value&&l("confirm",t.value)}function a(p){const i=p.target.value,[f,A]=i.split(";");d.value=A==="directory",t.value=s.value.find(M=>M.path===f&&M.kind===A)}const{files:s,currentPath:o}=L(B()),{openDir:_,goBack:r}=B();return(p,v)=>n.show?(m(),h("sp-dialog",{key:0,class:"w-[25rem] bg-zinc-900","no-divider":"",dismissable:"",onClose:v[1]||(v[1]=i=>l("update:show",!1))},[e("div",oe,[ne,e("sp-search",{value:u(o),class:"w-[15rem]"},null,8,le)]),e("div",ie,[e("sp-menu",{class:"w-full",selects:"single",onChange:a},[(m(!0),h(U,null,j(u(s),i=>(m(),h("sp-menu-item",{key:i.kind+i.path,value:`${i.path};${i.kind}`,onDblclick:f=>u(_)(i.path)},[e("ion-icon",{slot:"icon",name:i.kind==="directory"?"folder":"document"},null,8,de),e("div",re,[e("span",null,P(i.name),1),i.kind==="directory"?(m(),h("ion-icon",ce)):C("",!0)])],40,ae))),128))],32)]),e("div",_e,[e("sp-button-group",ue,[e("sp-button",{variant:"secondary",treatment:"outline",onClick:v[0]||(v[0]=(...i)=>u(r)&&u(r)(...i))},"Go Back"),e("sp-button",{static:"white",id:"file-dialog-confirm-btn",disabled:d.value,onClick:c},"Confirm",8,me)])])],32)):C("",!0)}}),D=(n,l)=>{const t=n.__vccOpts||n;for(const[d,c]of l)t[d]=c;return t},fe={},he={class:"grid items-center justify-center h-full"};function ve(n,l){return m(),h("div",he,[O(n.$slots,"default",{styleData:{"grid-area":"1/1"}})])}const be=D(fe,[["render",ve]]),ke="/fastLLaMa/assets/image-2ce0e742.png",we={class:"flex flex-col items-center justify-center"},ye=["src"],ge={class:"min-w-fit my-2"},xe=S({__name:"TheHomeWelcomeScreen",emits:["select-model","connect-websocket"],setup(n,{emit:l}){const t=N(),{isConnected:d}=L(t);return(c,a)=>(m(),h("div",we,[e("img",{src:u(ke),class:"h-[30rem] aspect-[1.66/1]"},null,8,ye),e("sp-button-group",ge,[u(d)?(m(),h("sp-button",{key:0,static:"white",onClick:a[0]||(a[0]=s=>l("select-model"))},"Select Model")):(m(),h("sp-button",{key:1,static:"white",onClick:a[1]||(a[1]=s=>l("connect-websocket"))},"Connect"))])]))}}),$e={theme:"spectrum",color:"darkest",scale:"medium",class:"h-full fixed top-0 left-0"},Ce={class:"loading-underlay",open:""},Se={class:"loading-container"},Ee=["label"],Ae=S({__name:"AppLoading",props:{modelValue:{type:Boolean},message:null,timeout:null},emits:["update:modelValue"],setup(n,{emit:l}){const t=n;return q(()=>{t.timeout!=null&&setTimeout(()=>{l("update:modelValue",!1)},t.timeout)}),(d,c)=>{const a=V("motion-fade"),s=V("motion-pop-visible");return n.modelValue?(m(),I(J,{key:0,to:"body"},[e("sp-theme",$e,[b(e("sp-underlay",Ce,null,512),[[a]]),b((m(),h("div",Se,[e("sp-progress-circle",{label:n.message,indeterminate:""},null,8,Ee),e("span",null,P(n.message),1)])),[[s]])])])):C("",!0)}}});const Me={slot:"heading",class:""},Te=e("h2",null,"Websocket Configuration",-1),Ve={key:0,variant:"positive"},ze={key:1,variant:"negative"},Ne={"onsubmit.prevent":""},Ie={class:"w-full"},Le=e("sp-field-label",{for:"websocket-address"},"Websocket Address",-1),Pe={class:"flex items-center gap-2 justify-between"},Be=["readonly","invalid"],Fe={class:"min-w-fit mt-2"},Ue=["disabled"],De=["disabled"],Re=S({__name:"AppConnectDialog",props:{show:{type:Boolean}},emits:["update:show"],setup(n,{emit:l}){const t=N(),{isConnecting:d,isConnected:c,errorMessage:a,hasError:s,address:o}=L(t),{connect:_,disconnect:r}=N(),p=x(!1);function v(){l("update:show",!1)}const i={resolve:w=>{},reject:w=>{},timeout:5e3};function f(w){w.type==="init-ack"&&(i.resolve(!0),t.off(f))}async function A(){return t.socket?(t.on(f),new Promise((w,k)=>{i.resolve=w,i.reject=k,t.message({type:"init",version:"1.0"}),setTimeout(()=>{k("websocket did not respond in time")},i.timeout)})):!1}async function M(){p.value=!0,_(async w=>{if(w){p.value=!1;return}try{await A()||(r(),s.value=!0,a.value="Websocket does not follow fastLLaMa protocol")}catch{r(),s.value=!0,a.value="Websocket does not respond in time, or does not support fastLLaMa protocol"}finally{p.value=!1}})}return(w,k)=>n.show?(m(),h("sp-dialog",{key:0,class:"w-[25rem] bg-zinc-900","no-divider":"",dismissable:"",onClose:v},[e("div",Me,[Te,u(c)?(m(),h("sp-status-light",Ve,"Connected")):(m(),h("sp-status-light",ze,"Disconnected"))]),e("form",Ne,[e("div",Ie,[Le,e("div",Pe,[b(e("sp-textfield",{id:"websocket-address",placeholder:"ws://localhost:8080",class:"mb-2 flex-grow",readonly:u(d),"onUpdate:modelValue":k[0]||(k[0]=E=>K(o)?o.value=E:null),invalid:u(s)},null,8,Be),[[y,u(o)]]),e("sp-progress-circle",{label:"Loading",indeterminate:"",static:"white",class:"mb-2",style:T({opacity:u(d)?"1":"0"})},null,4)]),b(e("sp-help-text",{variant:"negative",icon:""},P(u(a)),513),[[Q,u(s)]])]),e("sp-button-group",Fe,[u(c)?(m(),h("sp-button",{key:1,variant:"negative",disabled:u(d),onClick:k[1]||(k[1]=(...E)=>u(r)&&u(r)(...E))},"Disconnect",8,De)):(m(),h("sp-button",{key:0,static:"white",disabled:u(d),onClick:M},"Connect",8,Ue))])]),$(Ae,{modelValue:p.value,"onUpdate:modelValue":k[2]||(k[2]=E=>p.value=E),message:"Connecting to websocket..."},null,8,["modelValue"])],32)):C("",!0)}});function We(n){var l;const t=F(n);return(l=t==null?void 0:t.$el)!=null?l:t}const Ge=G?window:void 0;function He(...n){let l,t,d,c;if(typeof n[0]=="string"||Array.isArray(n[0])?([t,d,c]=n,l=Ge):[l,t,d,c]=n,!l)return R;Array.isArray(t)||(t=[t]),Array.isArray(d)||(d=[d]);const a=[],s=()=>{a.forEach(p=>p()),a.length=0},o=(p,v,i,f)=>(p.addEventListener(v,i,f),()=>p.removeEventListener(v,i,f)),_=Y(()=>[We(l),F(c)],([p,v])=>{s(),p&&a.push(...t.flatMap(i=>d.map(f=>o(p,i,f,v))))},{immediate:!0,flush:"post"}),r=()=>{_(),s()};return W(r),r}const g=n=>(ee("data-v-9ffcd630"),n=n(),te(),n),Xe=["open"],je=g(()=>e("div",{slot:"heading",class:""},[e("h2",null,"Model Parameters")],-1)),Oe={"onsubmit.prevent":""},qe={class:"flex flex-wrap items-center",style:{gap:"0.5rem 2rem"}},Je={class:"flex-grow"},Ke=g(()=>e("sp-field-label",{for:"model_init_n_threads"},"Number of threads",-1)),Qe=["max"],Ye={class:"flex-grow"},Ze=g(()=>e("sp-field-label",{for:"model_init_n_ctx"},"Context Size",-1)),et=["max"],tt={class:"flex-grow"},st=g(()=>e("sp-field-label",{for:"model_init_last_n_size"},"Token history size",-1)),ot=["max"],nt={class:"flex-grow"},lt=g(()=>e("sp-field-label",{for:"model_init_tokens_to_keep"},"Token to keep",-1)),it=["max"],at={class:"flex-grow"},dt=g(()=>e("sp-field-label",{for:"model_init_n_batch"},"Batch Size",-1)),rt=["max"],ct={class:"flex-grow"},_t=g(()=>e("sp-field-label",{for:"model_init_n_load_parallel_blocks"},"Parallel load Batch Size",-1)),ut=["max"],mt={class:"flex-grow mt-5 w-[8rem]"},pt=["checked"],ft={class:"flex-grow mt-5 w-[8rem]"},ht=["checked"],vt={class:"w-full"},bt=g(()=>e("sp-field-label",{for:"model_init_seed"},"Seed",-1)),kt=["max"],wt={class:"min-w-fit mt-8"},yt=S({__name:"TheHomeModelParameters",props:{show:{type:Boolean}},emits:["update:show","confirm"],setup(n,{emit:l}){const t=Z({n_threads:4,n_ctx:512,last_n_size:64,seed:0,tokens_to_keep:200,n_batch:16,use_mmap:!1,use_mlock:!1,load_parallel:!1,n_load_parallel_blocks:1});function d(){l("update:show",!1)}function c(a,s){const o=s.target;t[a]=o.checked}return(a,s)=>(m(),h(U,null,[e("sp-underlay",{open:n.show},null,8,Xe),n.show?(m(),h("sp-dialog",{key:0,class:"w-[25rem] bg-zinc-900","no-divider":"",dismissable:"",onClose:d},[je,e("form",Oe,[e("div",qe,[e("div",Je,[Ke,b(e("sp-number-field",{name:"model_init_n_threads",id:"model_init_n_threads",min:"0",max:Number.MAX_SAFE_INTEGER,class:"w-[8rem]","onUpdate:modelValue":s[0]||(s[0]=o=>t.n_threads=o)},null,8,Qe),[[y,t.n_threads,void 0,{number:!0}]])]),e("div",Ye,[Ze,b(e("sp-number-field",{name:"model_init_n_ctx",id:"model_init_n_ctx",min:"0",max:Number.MAX_SAFE_INTEGER,class:"w-[8rem]","onUpdate:modelValue":s[1]||(s[1]=o=>t.n_ctx=o)},null,8,et),[[y,t.n_ctx,void 0,{number:!0}]])]),e("div",tt,[st,b(e("sp-number-field",{name:"model_init_last_n_size",id:"model_init_last_n_size",min:"0",max:Number.MAX_SAFE_INTEGER,class:"w-[8rem]","onUpdate:modelValue":s[2]||(s[2]=o=>t.last_n_size=o)},null,8,ot),[[y,t.last_n_size,void 0,{number:!0}]])]),e("div",nt,[lt,b(e("sp-number-field",{name:"model_init_tokens_to_keep",id:"model_init_tokens_to_keep",max:Number.MAX_SAFE_INTEGER,min:"0",class:"w-[8rem]","onUpdate:modelValue":s[3]||(s[3]=o=>t.tokens_to_keep=o)},null,8,it),[[y,t.tokens_to_keep,void 0,{number:!0}]])]),e("div",at,[dt,b(e("sp-number-field",{name:"model_init_n_batch",id:"model_init_n_batch",min:"0",max:Number.MAX_SAFE_INTEGER,class:"w-[8rem]","onUpdate:modelValue":s[4]||(s[4]=o=>t.n_batch=o)},null,8,rt),[[y,t.n_batch,void 0,{number:!0}]])]),e("div",ct,[_t,b(e("sp-number-field",{name:"model_init_n_load_parallel_blocks",id:"model_init_n_load_parallel_blocks",min:"0",max:Number.MAX_SAFE_INTEGER,class:"w-[8rem]","onUpdate:modelValue":s[5]||(s[5]=o=>t.n_load_parallel_blocks=o)},null,8,ut),[[y,t.n_load_parallel_blocks,void 0,{number:!0}]])]),e("div",mt,[e("sp-checkbox",{checked:t.use_mmap,onChange:s[6]||(s[6]=o=>c("use_mmap",o))},"Mmap",40,pt)]),e("div",ft,[e("sp-checkbox",{checked:t.load_parallel,onChange:s[7]||(s[7]=o=>c("load_parallel",o))},"Parallel load",40,ht)])]),e("div",vt,[bt,b(e("sp-number-field",{name:"model_init_seed",id:"model_init_seed",min:"0",max:Number.MAX_SAFE_INTEGER,class:"w-full","onUpdate:modelValue":s[8]||(s[8]=o=>t.seed=o)},null,8,kt),[[y,t.seed,void 0,{number:!0}]])]),e("sp-button-group",wt,[e("sp-button",{static:"white",onClick:s[9]||(s[9]=o=>l("confirm",t))},"Initialize")])])],32)):C("",!0)],64))}});const gt=D(yt,[["__scopeId","data-v-9ffcd630"]]),Ct=S({__name:"HomeView",setup(n){const l=x(!1),t=se();function d(_){s.value=_,a.value=!0}const c=x(!1);He(document,"keyup",_=>{_.key==="Escape"&&(l.value=!1,c.value=!1)});const a=x(!1),s=x(null);async function o(_){if(!s.value)return;a.value=!1;const r=JSON.stringify({n_threads:_.n_threads,n_ctx:_.n_ctx,last_n_size:_.last_n_size,seed:_.seed,tokens_to_keep:_.tokens_to_keep,n_batch:_.n_batch,use_mmap:_.use_mmap,use_mlock:_.use_mlock,load_parallel:_.load_parallel,n_load_parallel_blocks:_.n_load_parallel_blocks});t.push({name:"chat",query:{model_params:r,path:s.value.path}})}return(_,r)=>{const p=V("motion-slide-visible-left"),v=V("motion-slide-visible-right");return m(),I(H,null,{aside:z(()=>[$(X)]),default:z(()=>[$(be,null,{default:z(({styleData:i})=>[!l.value&&!c.value?b((m(),I(xe,{key:0,style:T(i),onSelectModel:r[0]||(r[0]=f=>l.value=!0),onConnectWebsocket:r[1]||(r[1]=f=>c.value=!0)},null,8,["style"])),[[p]]):C("",!0),b($(pe,{style:T(i),show:l.value,"onUpdate:show":r[2]||(r[2]=f=>l.value=f),onConfirm:d},null,8,["style","show"]),[[v]]),b($(Re,{show:c.value,"onUpdate:show":r[3]||(r[3]=f=>c.value=f),style:T(i)},null,8,["show","style"]),[[v]]),$(gt,{show:a.value,"onUpdate:show":r[4]||(r[4]=f=>a.value=f),onConfirm:o},null,8,["show"])]),_:1})]),_:1})}}});export{Ct as default};
